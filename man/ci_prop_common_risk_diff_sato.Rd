% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prop_ci_common_risk.R
\name{ci_prop_common_risk_diff_sato}
\alias{ci_prop_common_risk_diff_sato}
\title{Mantel-Haenszel Common Risk Difference Confidence Interval (Sato Variance)}
\usage{
ci_prop_common_risk_diff_sato(x, by, strata, conf.level = 0.95, data = NULL)
}
\arguments{
\item{x}{(\code{binary}/\code{numeric}/\code{logical})\cr
vector of a binary values, i.e. a logical vector, or numeric with values \code{c(0, 1)}}

\item{by}{(\code{string}) \cr A character or factor vector with exactly two unique levels
identifying the two groups to compare. Can also be a column name if a data
frame provided in the \code{data} argument.}

\item{strata}{(\code{numeric}) \cr A vector specifying the stratum for each observation. It needs
to be the length of x or a multiple of x if multiple levels of strata are
present. Can also be a column name (or vector of column names NOT quoted)
if a data frame provided in the \code{data} argument.}

\item{conf.level}{(\verb{scalar numeric}) \cr a scalar in (0,1) indicating the confidence level. Default is 0.95}

\item{data}{(\code{data.frame}) \cr Optional data frame containing the variables specified in \code{x} and \code{by}.}
}
\value{
An object containing the following components:

\item{estimate}{The Mentel-Haeszel estimated common risk difference}
\item{conf.low}{Lower bound of the confidence interval}
\item{conf.high}{Upper bound of the confidence interval}
\item{conf.level}{The confidence level used}
\item{statistic}{Z-Statistic under the null hypothesis, assuming a common risk difference of 0}
\item{p.value}{p-value under the null hypothesis, assuming a common risk difference of 0}
\item{method}{Description of the method used ("Mentel-Haenszel Confidence Interval, Sato Variance")}
}
\description{
Calculates the confidence interval for the Mantel-Haenszel estimate of the common risk difference across multiple 2x2 tables (strata), using the Sato variance estimator.
}
\details{
The Mantel-Haenszel common risk difference is computed as:

\deqn{\hat{d}_{MH} = \sum_{h=1}^H w_h \left( \frac{s_{xh}}{n_{xh}} - \frac{s_{yh}}{n_{yh}} \right)}

where \eqn{w_h = \frac{n_{xh} n_{yh}}{n_{xh} + n_{yh}} / \sum_{h=1}^H \frac{n_{xh} n_{yh}}{n_{xh} + n_{yh}}} is the normalized stratum weight, \eqn{s_{xh}} and \eqn{s_{yh}} are the number of events in each group, and \eqn{n_{xh}}, \eqn{n_{yh}} are the group sizes in stratum \eqn{h}.

The Sato variance is:

\deqn{\mathrm{Var}_{Sato}(\hat{d}_{MH}) = \frac{\hat{d}_{MH} \sum_h p_h + \sum_h q_h}{\left( \sum_h \frac{n_{xh} n_{yh}}{n_{xh} + n_{yh}} \right)^2}}

where \eqn{p_h = \frac{n_{xh}^2 s_{yh} - n_{yh}^2 s_{xh} + n_{xh} n_{yh} (n_{yh} - n_{xh})/2}{N_h^2}} and \eqn{q_h = \frac{s_{xh}(n_{yh} - s_{yh}) + s_{yh}(n_{xh} - s_{xh})}{2 N_h}}, with \eqn{N_h = n_{xh} + n_{yh}}.

The confidence interval is then \eqn{\hat{d}_{MH} \pm z_{1-\alpha/2} \sqrt{\mathrm{Var}_{Sato}(\hat{d}_{MH})}}.
}
\examples{
# Example with simulated data
set.seed(1)
strata <- rep(1:3, each = 40)
by <- rep(c("A", "B"), times = 60)
x <- rbinom(120, 1, prob = rep(c(0.2, 0.3, 0.4), each = 40))
result <- ci_prop_common_risk_diff_sato(x = x, by = by, strata = strata)
print(result)
}
